<section id="terminal-home">
  <div class="home-terminal">
    <div class="home-terminal-header">
      <span class="home-terminal-dot red"></span>
      <span class="home-terminal-dot yellow"></span>
      <span class="home-terminal-dot green"></span>
      <span class="home-terminal-title">flappy@blog:~</span>
    </div>
    <div class="home-terminal-body" id="homeTerminal">
      <div id="homeOutput"></div>
      <div class="home-cursor" id="homeCursor"><span class="home-prompt">$</span> <span id="homeCursorBlink" class="home-blink">_</span></div>
    </div>
  </div>
</section>

<!-- Nav data for JS -->
<script>
var NAV_ITEMS = [
<% for (var i in theme.nav) { %>
  <% if (i !== 'home') { %>
  { url: "<%- url_for(theme.nav[i]) %>", label: "<%= __('nav.'+i).replace('nav.', '') %>" },
  <% } %>
<% } %>
];
</script>

<% if (site.data.pinned) { %>
<section id="pinned">
  <span class="h1"><%= __('index.pinned') %></span>
  <ul>
    <% for(var obj in site.data.pinned){ %>
        <span class="h4"><b><a href="<%= site.data.pinned[obj].url %>"><%= site.data.pinned[obj].name %></a></b></span>
        <p><i><%- markdown(site.data.pinned[obj].desc) %></i></p>
    <% } %>
  </ul>
</section>
<% } %>

<section id="writing">
    <span class="h1"><a href="<%- url_for(theme.nav.articles) %>"><%= __('index.articles') %></a></span>
    <% if (theme.tags_overview && site.tags.length) { %>
    <span class="h2"><%= __('index.topics') %></span>
    <span class="widget tagcloud">
      <%- tagcloud(theme.tags_overview) %>
    </span>
    <span class="h2"><%= __('index.most_recent') %></span>
    <% } %>
    <ul class="post-list">
      <% var field_sort = theme.posts_overview.sort_updated ? 'updated' : 'date' %>
      <% if (theme.posts_overview.show_all_posts) { %>
        <% var show_posts = page.posts.sort(field_sort, 'desc') %>
      <% } else { %>
        <% var show_posts = site.posts.sort(field_sort, 'desc').limit(theme.posts_overview.post_count || 5) %>
      <% } %>
      <% show_posts.each(function(post, i){ %>
        <li class="post-item">
          <%- partial('_partial/post/date', { post: post, class_name: 'meta' }) %>
          <span><%- partial('_partial/post/title', { post: post, index: true, class_name: '' }) %></span>
        </li>
      <% }); %>
    </ul>
    <% if (theme.posts_overview.show_all_posts) { %>
      <%- partial('_partial/pagination') %>
    <% } %>
  </section>

<% if (site.data.categories) { %>
<section id="categories">
    <span class="h1"><%= __('index.categories') %></span>
    <ul class="project-list">
    <% for(var obj in site.data.categories){ %>
        <li class="project-item">
        <a href="<%= site.data.categories[obj].url %>"><%= site.data.categories[obj].name %></a>: <%- markdown(site.data.categories[obj].desc) %>
        </li>
    <% } %>
    </ul>
</section>
<% } %>

<script>
(function() {
  var out = document.getElementById('homeOutput');
  var cursor = document.getElementById('homeCursor');
  var blink = document.getElementById('homeCursorBlink');
  var speed = 30;
  var cmdSpeed = 40;
  var lineDelay = 80;
  var cmdDelay = 300;

  function addLine(html, cls) {
    var div = document.createElement('div');
    div.className = 'home-terminal-line' + (cls ? ' ' + cls : '');
    div.innerHTML = html;
    out.appendChild(div);
  }

  function typeCmd(text, cb) {
    cursor.style.display = 'none';
    var line = document.createElement('div');
    line.className = 'home-terminal-line';
    line.innerHTML = '<span class="home-prompt">$</span> ';
    out.appendChild(line);
    var i = 0;
    var span = document.createElement('span');
    span.className = 'home-typed-cmd';
    line.appendChild(span);
    function next() {
      if (i < text.length) {
        span.textContent += text[i];
        i++;
        setTimeout(next, cmdSpeed);
      } else {
        setTimeout(cb, cmdDelay);
      }
    }
    next();
  }

  function printLines(lines, cb) {
    var i = 0;
    function next() {
      if (i < lines.length) {
        var item = lines[i];
        if (typeof item === 'string') {
          addLine(item);
        } else {
          addLine(item.html, item.cls);
        }
        i++;
        setTimeout(next, lineDelay);
      } else {
        setTimeout(cb, cmdDelay);
      }
    }
    next();
  }

  function printHtmlBlock(html, cb) {
    var div = document.createElement('div');
    div.innerHTML = html;
    div.style.opacity = '0';
    div.style.transition = 'opacity 0.3s';
    out.appendChild(div);
    requestAnimationFrame(function() {
      div.style.opacity = '1';
    });
    setTimeout(cb, cmdDelay);
  }

  // Build nav buttons HTML
  var navHtml = '<div class="home-nav-links">';
  NAV_ITEMS.forEach(function(item) {
    navHtml += '<a href="' + item.url + '" class="home-nav-item"><span class="home-nav-icon">></span> ' + item.label + '/</a>';
  });
  navHtml += '</div>';

  // Build social buttons HTML
  var socialHtml = '<div class="home-social-links">'
    + '<a href="https://github.com/FlappyBob" target="_blank" rel="noopener" class="home-social-btn" title="GitHub"><i class="fa-brands fa-github"></i> GitHub</a>'
    + '<a href="mailto:sy3535@nyu.com" class="home-social-btn" title="Email"><i class="fa-solid fa-envelope"></i> Gmail</a>'
    + '<a href="https://www.zhihu.com/people/flappyboba" target="_blank" rel="noopener" class="home-social-btn" title="Zhihu"><i class="fa-brands fa-zhihu"></i> 知乎</a>'
    + '<a href="https://x.com/FlappyHimself" target="_blank" rel="noopener" class="home-social-btn" title="X"><i class="fa-brands fa-x-twitter"></i> X</a>'
    + '</div>';

  // Sequence
  setTimeout(function() {
    typeCmd('cat welcome.txt', function() {
      printLines([
        '',
        { html: '<span class="home-output-accent">Welcome to VA-11 HALL-A!</span>' },
        { html: '<span class="home-output-dim">欢迎光临VA-11 HALL-A！这个酒馆(博客)是我有关学习、科研、生活、见识的相对随性的杂谈。</span>' },
        ''
      ], function() {
        typeCmd('ls pages/', function() {
          addLine('');
          printHtmlBlock(navHtml, function() {
            addLine('');
            typeCmd('cat socials.txt', function() {
              addLine('');
              printHtmlBlock(socialHtml, function() {
                addLine('');
                cursor.style.display = '';
              });
            });
          });
        });
      });
    });
  }, 300);
})();
</script>
